---
title: "Prep_Questionnaires"
author: "Pauliina Vuorinen"
date: "28/06/2022-"
output: html_document
library: "~/Extra/RPackages.bib"
---

## Introduction

The purpose of this script is to prepare questionnaire data for use in the analysis.

Three different questionnaires are processed: (1) Intrinsic Motivation Inventory (IMI), (2) IMI-R: task specific Intrinsic Motivation Inventory, and (3) Questionnaire on electronic reading experience. Our intention is to use these questionnaires to create 6 different variables to use in the analysis:

From the IMI (1):
* A measure of contextual reading motivation

From the IMI-R (2):
* 'Task competence' to study participants' perceived difficulty reading the short story
* 'Task autonomy' to check the effect of the condition manipulation
* 'Task interest' to check the effect of the condition manipulation

From the questionnaire on electronic reading experience (3):
* A measure of experience using task-specific devices for any electronic reading
* A measure of experience reading task-specific texts on any electronic devices

## Setup

Load libraries, set working directory

```{r, setup}
library(tidyverse)
library(tidyr)
library(dplyr)
getwd() # check that working directory is ~/Short_Story_Reading_Behaviour_Public
```

## Load data

```{r, load data}
raw_questionnaire_data <- read.csv(
        "Data/raw_questionnaire_data.csv",
        header = TRUE,
        sep = ";",
        dec = ","
    )
```

```{r, change variable types}
str(raw_questionnaire_data)
source("Functions/Functions_VariableTypeConversion.R")

## turn columns into factors that should be factors
names(raw_questionnaire_data)[names(raw_questionnaire_data) == "BookId"] <- "StoryId"
raw_questionnaire_data[, c(
    "UserId",
    "StoryId"
)] <- convert.magic(
    raw_questionnaire_data[, c(
        "UserId",
        "StoryId"
    )],
    "factor"
)
```

The questionnaire data has answers from participants who didn't complete the data in full, and these participants are excluded:

```{r, remove excluded}
raw_questionnaire_data <-
    filter(
        raw_questionnaire_data,
        UserId != "33"
        )
raw_questionnaire_data <-
    filter(
        raw_questionnaire_data,
        UserId != "61"
    )
raw_questionnaire_data <-
    filter(
        raw_questionnaire_data,
        UserId != "81"
    )
```

## Create datasets from the questions and answers

To efficiently access the questionnaire data, we create two separate datasets:
* all_answer_data
    * Contains only the following columns: UserId, Questionnaire (Ids to identify the Questionnaires), QuestionNumber, and Answer
    * Used to study the answers and group them together
    * In this dataset the answers are organised by UserId under columns of which headings show QuestionnaireId_QuestionNumber
* all_questions_data
    * Used to check which question matches the 'Questionnaire' Id and 'QuestionNumber'
    * The column headings show QuestionnaireId_QuestionNumber and the values show the corresponding 'Question'

```{r, create answer and question datasets}
all_answer_data <- raw_questionnaire_data %>%
    group_by(UserId) %>%
    select(-Question, -StoryId) %>%
    pivot_wider(names_from = c(Questionnaire, QuestionNumber),
              values_from = Answer
)
all_questions_data <- raw_questionnaire_data %>%
    select(-UserId, -StoryId, -Answer) %>%
    distinct() %>%
    pivot_wider(names_from = c(Questionnaire, QuestionNumber),
                values_from = Question
)
```

## Participant demographics

We check participants' demographic information, including their gender, age, and whether English is their native language or not. First, we create a new dataset with only these columns:

```{r, create a dataset on demographics}
demographics_data <-
    all_answer_data[, c(1, 22:24)] 
names(demographics_data)[2:4] <- c("Age", "Gender", "NativeEnglish")
str(demographics_data)
demographics_data$Age <-
    as.numeric(
    demographics_data$Age
    )
```

Second, we study demographics of the sample:
- The sample includes 35 women, 24 men, and one participant who preferred not to disclose their gender.
- The participants' average age is 21.53 (*SD* = 2.21), and age range is 19-30
- Forty-three of the 60 participants (71.67%) are native speakers of English, whereas the remaining 17 participants are not.

```{r, demographics}
# Gender
table(demographics_data$Gender)
# Age
mean(demographics_data$Age)
sd(demographics_data$Age)
range(demographics_data$Age)
# Native language
table(demographics_data$NativeEnglish)
```

## Intrinsic Motivation Inventory (IMI)

IMI is used in the study to measure participants' situational reading motivation.
The questionnaire consists of multiple different components:
* Interest: participants' interest in the short story and their enjoyment of the task
* Competence: participants' perceived difficulty reading the short story
* Effort: participants' perceived effortfulness of reading the short story
* Pressure: participants' feelings of pressure to read the short story
* Choice: participants' perceived autonomy in reading the short story

The sample is not sufficiently large for a confirmatory factor analysis (which requires *n* > 200), and therefore, we rely on the above components which were proposed by previous research [e.g. XX].
First, we create a dataset with only the responses to IMI and tidy the answers to usable format:
```{r, create dataset for IMI}
# select correct columns from all_answer_data
IMI_data <- all_answer_data[, c(1, 38:64)]
# remove special characters from answers
IMI_data <- as.data.frame(IMI_data)
for (item in 2:length(IMI_data)) {
  IMI_data[, item] <- substr(
    IMI_data[, item],
        1,
        1
    )
}
IMI_data <- IMI_data %>%
    mutate_if(is.character, as.numeric
)
```

Some of the IMI items are reverse coded. These items are reversed:

```{r, reverse IMI questions}
# reversed questions
ReversedItemsIMI <- c("questionnaire22_9",
                      "questionnaire22_10",
                      "questionnaire22_11",
                      "questionnaire22_12",
                      "questionnaire22_16",
                      "questionnaire22_17",
                      "questionnaire22_20",
                      "questionnaire22_25",
                      "questionnaire22_26",
                      "questionnaire22_27",
                      "questionnaire22_29",
                      "questionnaire22_30")
for (item in 2:length(IMI_data)) {
  if (any((colnames(IMI_data)[item]) == ReversedItemsIMI)) {
    IMI_data[, item] = 8 - IMI_data[, item]
  }
}
```

Finally, we group IMI responses together from each of the components:

```{r, group IMI responses}
# in progress
TaskIMIGrouped <- data.frame(UserId = TaskIMI$UserId,
                    FullScoreWoPressure = ((apply(TaskIMI[c(2:5, 7:18, 20:28)], 1, sum))/length(TaskIMI[c(2:5, 7:18, 20:28)])),
                    Interest = (apply(TaskIMI[c(2, 5, 8, 12, 16, 20, 22)], 1, sum)/length(TaskIMI[c(2, 5, 8, 12, 16, 20, 22)])),
                    Competence = (apply(TaskIMI[c(3, 9, 13, 17, 27, 28)], 1, sum)/length(TaskIMI[c(3, 9, 13, 17, 27, 28)])),
                    Effort = (apply(TaskIMI[c(7, 11, 18, 23, 25)], 1, sum)/length(TaskIMI[c(7, 11, 18, 23, 25)])),
                  #  Pressure = (apply(TaskIMI[c(6, 19)], 1, sum)/length(TaskIMI[c(6, 19)])), # Pressure not used due to no correlation
                    Choice = (apply(TaskIMI[c(4, 10, 14, 15, 21, 24, 26)], 1, sum)/length(TaskIMI[c(4, 10, 14, 15, 21, 24, 26)]))
)
```